# üîê –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –ü—Ä–æ–±–ª–µ–º–∞: –°–µ–∫—Ä–µ—Ç—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ Git

–í –∏—Å—Ç–æ—Ä–∏–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏:
- `BOT_TOKEN=<REMOVED>`
- `DB_PASSWORD=<REMOVED>`
- `REDIS_PASSWORD=<REMOVED>`
- `ENCRYPTION_KEY=<REMOVED>=`

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –≠—Ç–∏ –∫–ª—é—á–∏ –±—ã–ª–∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∏—Å—Ç–æ—Ä–∏–∏ Git!

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–†–û–ß–ù–û:

### 1. –°–º–µ–Ω–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ!

#### BOT_TOKEN:
1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/revoke` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –∫–æ–º–∞–Ω–¥–æ–π `/token`
4. –û–±–Ω–æ–≤–∏—Ç–µ `BOT_TOKEN` –≤ `.env` —Ñ–∞–π–ª–µ

#### DB_PASSWORD:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL:
   ```bash
   psql -U bot_user -d shift_bot
   ```
2. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å:
   ```sql
   ALTER USER bot_user WITH PASSWORD '–Ω–æ–≤—ã–π_–Ω–∞–¥–µ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å';
   ```
3. –û–±–Ω–æ–≤–∏—Ç–µ `DB_PASSWORD` –≤ `.env` —Ñ–∞–π–ª–µ

#### REDIS_PASSWORD:
1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Redis:
   ```bash
   redis-cli
   ```
2. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤ `redis.conf`:
   ```
   requirepass –Ω–æ–≤—ã–π_–Ω–∞–¥–µ–∂–Ω—ã–π_–ø–∞—Ä–æ–ª—å
   ```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Redis
4. –û–±–Ω–æ–≤–∏—Ç–µ `REDIS_PASSWORD` –≤ `.env` —Ñ–∞–π–ª–µ

#### ENCRYPTION_KEY:
1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á:
   ```bash
   python -c "import secrets; print(secrets.token_urlsafe(32))"
   ```
2. –û–±–Ω–æ–≤–∏—Ç–µ `ENCRYPTION_KEY` –≤ `.env` —Ñ–∞–π–ª–µ

### 2. –£–¥–∞–ª–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ Git

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ –∏–∑–º–µ–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è!

#### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
bash scripts/remove_secrets_from_history.sh
```

#### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é —Å git-filter-repo

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ git-filter-repo:
   ```bash
   pip install git-filter-repo
   ```

2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `replacements.txt`:
   ```
   BOT_TOKEN=<REMOVED>==>BOT_TOKEN=<REMOVED>
   DB_PASSWORD=<REMOVED>==>DB_PASSWORD=<REMOVED>
   REDIS_PASSWORD=<REMOVED>==>REDIS_PASSWORD=<REMOVED>
   ENCRYPTION_KEY=<REMOVED>==>ENCRYPTION_KEY=<REMOVED>
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ git-filter-repo:
   ```bash
   git filter-repo --replace-text replacements.txt --force
   ```

4. –£–¥–∞–ª–∏—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª:
   ```bash
   rm replacements.txt
   ```

### 3. Force push (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –∫–ª—é—á–µ–π!)

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –≠—Ç–æ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏!

```bash
git push --force --all
git push --force --tags
```

### 4. –£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–æ–≤

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ã:
1. –£–≤–µ–¥–æ–º–∏—Ç–µ –∏—Ö –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏
2. –ò–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:
   ```bash
   # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
   rm -rf telegram-shift-bot
   # –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–Ω–æ–≤–æ
   git clone <repository-url>
   cd telegram-shift-bot
   ```

## –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤

### Pre-commit hook

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω pre-commit hook, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º.

–ï—Å–ª–∏ hook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é:

```bash
cp scripts/check_secrets.sh .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä—É—á–Ω—É—é

–ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∫–æ–º–º–∏—Ç–æ–º –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å staged —Ñ–∞–π–ª—ã
git diff --cached | grep -iE "BOT_TOKEN|DB_PASSWORD|REDIS_PASSWORD|ENCRYPTION_KEY"

# –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–≤–µ–¥–µ–Ω–æ - –º–æ–∂–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å
# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –≤—ã–≤–µ–¥–µ–Ω–æ - –ù–ï –ö–û–ú–ú–ò–¢–¨–¢–ï!
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Secrets** –¥–ª—è CI/CD (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
2. **–†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏** (—Ä–∞–∑ –≤ 3-6 –º–µ—Å—è—Ü–µ–≤)
3. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä–æ–ª–∏** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
5. **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã** –≤:
   - –ö–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
   - –õ–æ–≥–∞—Ö
   - –°–∫—Ä–∏–Ω—à–æ—Ç–∞—Ö
   - –°–æ–æ–±—â–µ–Ω–∏—è—Ö –≤ —á–∞—Ç–∞—Ö

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ .env –Ω–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è
git ls-files | grep -E "\.env$"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
git log --all --source --full-history -p | grep -E "BOT_TOKEN|DB_PASSWORD|REDIS_PASSWORD|ENCRYPTION_KEY" | grep -v "<REMOVED>"

# –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–≤–µ–¥–µ–Ω–æ - —Å–µ–∫—Ä–µ—Ç—ã —É–¥–∞–ª–µ–Ω—ã –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
```

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [GitHub Security Best Practices](https://docs.github.com/en/code-security)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [12 Factor App - Config](https://12factor.net/config)

